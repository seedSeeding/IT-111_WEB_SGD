;/*FB_PKG_DELIM*/

__d("LSAddPollOption",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(39).add({optionId:a[0],pollId:a[1],optionText:a[2],voteCount:b.i64.cast([0,0]),sortKeyVotingTimestamp:a[3],sortKeyCreationTimestamp:a[4]})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxAddPollOptionStoredProcedure";a.__tables__=["poll_options_v2"];e.exports=a}),null);
__d("LSAddPollVote",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.db.table(40).add({optionId:a[0],pollId:a[1],contactId:a[2],timestampMs:a[3]})},function(c){return b.forEach(b.filter(b.db.table(39).fetch([[[a[1],a[0]]]]),function(c){return b.i64.eq(c.optionId,a[0])&&b.i64.eq(c.pollId,a[1])&&b.i64.le(c.sortKeyVotingTimestamp,a[3])}),function(b){var c=b.update;b.item;return c({voteCount:a[4],sortKeyVotingTimestamp:a[3]})})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxAddPollVoteStoredProcedure";a.__tables__=["poll_votes_v2","poll_options_v2"];e.exports=a}),null);
__d("LSHandlePlaceholderPollData",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.db.table(38).fetch([[[a[0]]]]).next().then(function(c,d){var e=c.done;c=c.value;return e?0:(d=c.item,b.filter(b.db.table(38).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.pollId,a[0])&&b.i64.gt(c.authorityLevel,b.i64.cast([0,80]))}).next().then(function(e){var c=e.done;e.value;return c?b.db.table(38).put({pollId:a[0],authorityLevel:b.i64.cast([0,80]),threadKey:d.threadKey,lastUpdateMessageId:d.lastUpdateMessageId,lastUpdateMessageTimestampMs:d.lastUpdateMessageTimestampMs,lastUpdateMessageEventType:d.lastUpdateMessageEventType,pollType:b.i64.cast([0,0]),pollStage:b.i64.cast([0,1])}):0}))})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxHandlePlaceholderPollDataStoredProcedure";a.__tables__=["polls"];e.exports=a}),null);