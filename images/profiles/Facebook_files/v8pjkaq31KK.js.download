;/*FB_PKG_DELIM*/

__d("LSOptimisticUnsendMessage",["LSGetViewerFBID","LSIssueNewTaskWithExtraOperations"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.i64.neq(a[1],void 0)?c.sequence([function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[3]=c.i64.cast([0,1]):(b=a.item,d[6]=b.syncGroup,c.i64.neq(d[6],void 0)?d[5]=d[6]:d[5]=c.i64.cast([0,1]),d[3]=d[5])})},function(a){return d[0]=d[3]}]):c.resolve(d[0]=c.i64.cast([0,1]))},function(e){return d[1]=new c.Map(),d[1].set("message_id",a[0]),d[1].set("thread_key",a[1]),d[1].set("sync_group",d[0]),c.i64.neq(a[1],void 0)?c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[3]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[4]=!1:(b=a.item,c.sequence([function(a){return c.filter(c.db.table(14).fetch([[[b.threadKey,d[3]]]]),function(a){return c.i64.eq(a.threadKey,b.threadKey)&&c.i64.eq(c.i64.cast([0,0]),b.mailboxType)&&c.i64.eq(a.contactId,d[3])}).next().then(function(e,f){var a=e.done;e=e.value;return a?d[6]=!1:(f=e.item,c.i64.eq(b.threadType,c.i64.cast([0,152]))?(d[9]=f.threadRoles,c.i64.lt(c.i64.cast([0,7]),c.i64.cast([0,0]))||c.i64.gt(c.i64.cast([0,7]),c.i64.cast([0,7]))?d[10]=!1:d[10]=!c.i64.eq(c.i64.and_(c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.cast([0,7]))),d[9]),c.i64.cast([0,0])),d[11]=b.capabilities,d[12]=b.capabilities2,d[13]=b.capabilities3,d[14]=b.capabilities4,d[15]=b.capabilities5,d[17]=c.i64.div(c.i64.cast([0,223]),c.i64.cast([0,64])),d[18]=c.i64.lsl_(c.i64.cast([0,1]),c.i64.to_int32(c.i64.sub(c.i64.cast([0,223]),c.i64.mul(d[17],c.i64.cast([0,64]))))),c.i64.lt(c.i64.cast([0,223]),c.i64.cast([0,0]))||c.i64.gt(c.i64.cast([0,223]),c.i64.cast([0,258]))?d[16]=!1:(c.i64.eq(d[17],c.i64.cast([0,0]))?d[19]=!c.i64.eq(c.i64.and_(d[18],d[11]),c.i64.cast([0,0])):(c.i64.eq(d[17],c.i64.cast([0,1]))?d[20]=!c.i64.eq(c.i64.and_(d[18],d[12]),c.i64.cast([0,0])):(c.i64.eq(d[17],c.i64.cast([0,2]))?d[21]=!c.i64.eq(c.i64.and_(d[18],d[13]),c.i64.cast([0,0])):(c.i64.eq(d[17],c.i64.cast([0,3]))?d[22]=!c.i64.eq(c.i64.and_(d[18],d[14]),c.i64.cast([0,0])):(c.i64.eq(d[17],c.i64.cast([0,4]))?d[23]=!c.i64.eq(c.i64.and_(d[18],d[15]),c.i64.cast([0,0])):d[23]=!1,d[22]=d[23]),d[21]=d[22]),d[20]=d[21]),d[19]=d[20]),d[16]=d[19]),d[10]===d[16]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting"),c["throw"]("LS::assert is failed. Thread role and thread capability don't agree for Broadcast Channels message-as-page functionality; aborting")),d[8]=d[10]):d[8]=!1,d[6]=d[8])})},function(a){return d[4]=d[6]}]))})},function(a){return d[4]?d[1].set("perform_action_as_page",!0):0}]):c.resolve()},function(e){return d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTaskWithExtraOperations"),"unsend_message",c.i64.cast([0,33]),d[2],void 0,void 0,a[2]==null?c.i64.cast([0,0]):a[2],c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),void 0,c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxOptimisticUnsendMessageStoredProcedure";a.__tables__=["threads","participants"];e.exports=a}),null);
__d("LSOptimisticUnsendMessageStoredProcedure",["LSOptimisticUnsendMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e=c("LSOptimisticUnsendMessage")(e.messageId,e.threadKey,e.pluginType,a);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(e))}g["default"]=a}),98);
__d("useMWV2GlobalRemoveMessage",["LSFactory","LSOptimisticUnsendMessageStoredProcedure","LSPlatformWaitForTaskCompletion","MWV2LogMessageClick","MessengerWebUXLogger","QPLUserFlow","Random","WebUserFlowLoggingDataContextProvider.react","asyncToGeneratorRuntime","qpl","react","react-compiler-runtime","react-forget-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=i||d("react");e.useCallback;e.useContext;function a(a){var e=d("react-compiler-runtime").c(5),f=(h||(h=c("useReStore")))(),g=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext,j),i=g.loggingDataRef,k=c("MessengerWebUXLogger").useInteractionLogger();e[0]!==f||e[1]!==a||e[2]!==k||e[3]!==i?(g=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("MWV2LogMessageClick").log(f,b,47);var e=c("qpl")._(25308285,"2002"),g=Date.now()+(Math.round(d("Random").random()*1e4)+1e4);c("QPLUserFlow").start(e,{annotations:{string:{isEphemeralMessage:b.ephemeralDurationInSec!=null||b.ephemeralExpirationTs!=null?"true":"false",type:"openUnsendMessage"}},instanceKey:g});var h;h=void 0;typeof a==="function"?h=(yield a(b)):h=a;return c("LSPlatformWaitForTaskCompletion")(f,function(a){return c("LSOptimisticUnsendMessageStoredProcedure")(c("LSFactory")(a),{messageId:b.messageId,pluginType:h,threadKey:b.threadKey})},"optimisticUnsendMessage").then(function(){k==null?void 0:k(babelHelpers["extends"]({},i.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(e,{instanceKey:g})})["catch"](function(a){return k==null?void 0:k(babelHelpers["extends"]({},i.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},i.current.extraData,{error:a.toString()})}))})});return function(a){return e.apply(this,arguments)}}(),e[0]=f,e[1]=a,e[2]=k,e[3]=i,e[4]=g):g=e[4];return g}function j(a){return[a.loggingDataRef]}g["default"]=a}),98);
__d("MWV2GlobalRemoveMessageDialog.react",["fbt","DeletionType.react","I64","LSContactBitOffset","LSMessagingThreadTypeUtil","MWDialogText.react","MWPActor.react","MWXCardedDialog.react","MWXDialogPageLegacy.react","MWXMultiStepDialog.react","MWXRadio.react","MessengerWebUXLogger","ReQL","ReQLSuspense","WebUserFlowLoggingDataContextProvider.react","cr:9774","cr:9775","gkx","promiseDone","react","useGetMediaGroupInformation","useMWV2GlobalRemoveMessage","useMWV2LocalRemoveMessage","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react")),m=k,n=m.useContext,o=m.useState;function a(a,b){return p}function p(a,b){}var q=b("cr:9774")==null?a:b("cr:9774");function e(){return r}function r(a,b){}var s=b("cr:9775")||e;function t(a){var b=a.learnMoreOnMessageRemove,e=a.message,g=a.onClose,k=a.removeLogger,m=a.threadType,p=(i||(i=c("useReStore")))();a=n(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext);var r=a.loggingDataRef;a=c("MessengerWebUXLogger").useImpressionLoggerRef(babelHelpers["extends"]({},r.current,{eventName:"message_remove_sheet_rendered"}));var t=c("MessengerWebUXLogger").useInteractionLogger(),u=d("LSMessagingThreadTypeUtil").isArmadilloSecure(m),v=q(e.threadKey,m),w=c("useGetMediaGroupInformation")(e,u),x=s(),y=c("useMWV2LocalRemoveMessage")(),z=c("useMWV2GlobalRemoveMessage")(),A=function(a){return c("promiseDone")(z(a))},B=u?h._("__JHASH__mgfzRCe5bWP__JHASH__"):h._("__JHASH__3nC2F2SOFIl__JHASH__"),C=c("gkx")("7855")?h._("__JHASH__oBth3b5GmEf__JHASH__"):h._("__JHASH__uQdYnP4xNl0__JHASH__"),D=c("gkx")("5320")?h._("__JHASH__-y5-g3zoiBR__JHASH__"):h._("__JHASH__jLFq-Qn9eN___JHASH__"),E=o(function(){return c("DeletionType.react").Global}),F=E[0],G=E[1],H=function(){t==null?void 0:t(babelHelpers["extends"]({},r.current,{eventName:"message_remove_confirm"}));F===c("DeletionType.react").Global?u?v(e,w):A(e):u?x(e,w):y(e);k&&k(F===c("DeletionType.react").Global?c("DeletionType.react").Global:c("DeletionType.react").Local);return g()},I=function(){g(),t==null?void 0:t(babelHelpers["extends"]({},r.current,{eventName:"message_remove_cancel"}))},J=d("MWPActor.react").useActor();E=d("ReQLSuspense").useFirst(function(){return d("LSMessagingThreadTypeUtil").isOneToOne(m)?d("ReQL").mergeJoin(d("ReQL").fromTableAscending(p.tables.participants).getKeyRange(e.threadKey),d("ReQL").fromTableAscending(p.tables.contacts)).filter(function(a){a[0];a=a[1];return!(j||(j=d("I64"))).equal(a.id,J)}):d("ReQL").empty()},[p,e.threadKey,m,J],f.id+":166");E=E!=null?(E=d("LSContactBitOffset").has(64,E[1]))!=null?E:!1:!1;E=u&&E;var K;E?K=null:K=l.jsxs(l.Fragment,{children:[l.jsx(c("MWXRadio.react"),{checked:F===c("DeletionType.react").Global,label:c("gkx")("7855")?h._("__JHASH__3WNPzP2whFB__JHASH__"):h._("__JHASH__Blkrb2PpT4H__JHASH__"),name:"radio",onChange:function(){G(c("DeletionType.react").Global),t==null?void 0:t("message_remove_for_all_attempt")},testid:void 0,value:c("DeletionType.react").Global}),l.jsx("div",babelHelpers["extends"]({className:"xdj266r x1gja9t x1hq5gj4 x8vdgqj"},{children:l.jsx(c("MWDialogText.react"),{color:"secondary",children:C})}))]});var L=l.jsxs(l.Fragment,{children:[l.jsx(c("MWXRadio.react"),{checked:F!==c("DeletionType.react").Global,label:c("gkx")("5320")?h._("__JHASH__tGD9Z1usAvD__JHASH__"):h._("__JHASH__lajVt418Pj8__JHASH__"),name:"radio",onChange:function(){return G(c("DeletionType.react").Local)},testid:void 0,value:c("DeletionType.react").Local}),l.jsx("div",babelHelpers["extends"]({className:"xdj266r x1gja9t x1hq5gj4 x8vdgqj"},{children:l.jsx(c("MWDialogText.react"),{color:"secondary",children:B})}))]});return b?l.jsx(c("MWXMultiStepDialog.react"),{onClose:I,ref:a,size:"medium",title:D,withCloseButton:!0,children:function(a){return l.jsxs(c("MWXDialogPageLegacy.react"),{primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:H,testid:"messenger_global_remove_dialog_submit",type:"primary"},secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:I},children:[K,L,b&&b(a)]})}}):l.jsxs(c("MWXCardedDialog.react"),{onClose:I,primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:H,testid:"messenger_global_remove_dialog_submit",type:"primary"},ref:a,secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:I},size:"medium",title:D,withCloseButton:!0,children:[K,L]})}t.displayName=t.name+" [from "+f.id+"]";g["default"]=t}),226);
__d("MWV2LocalRemoveMessageDialog.react",["fbt","LSMessagingThreadTypeUtil","MWDialogText.react","MWXCardedDialog.react","MessengerWebUXLogger","WebUserFlowLoggingDataContextProvider.react","react","useHandleRemoveLocalMessage"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;function a(a){var b=a.message,e=a.onClose,f=a.removeLogger;a=a.threadType;var g=d("LSMessagingThreadTypeUtil").isArmadilloSecure(a),i=k(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext),l=i.loggingDataRef;i=c("MessengerWebUXLogger").useImpressionLoggerRef(babelHelpers["extends"]({},l.current,{eventName:"message_remove_sheet_rendered"}));var m=c("MessengerWebUXLogger").useInteractionLogger(),n=c("useHandleRemoveLocalMessage")(a,b,f);a=function(){n(l.current);return e()};b=function(){e(),m==null?void 0:m(babelHelpers["extends"]({},l.current,{eventName:"message_remove_cancel"}))};f=h._("__JHASH__MtviLGqEBTm__JHASH__");return j.jsx(c("MWXCardedDialog.react"),{hasTextOnlyContent:!0,onClose:b,primaryCallToAction:{label:h._("__JHASH__hqbvAdrkmFp__JHASH__"),onPress:a,testid:"messenger_local_remove_dialog_submit"},ref:i,secondaryCallToAction:{label:h._("__JHASH__ddF1YsNwDg4__JHASH__"),onPress:b},size:"small",title:f,withCloseButton:!0,children:j.jsx(c("MWDialogText.react"),{children:g?h._("__JHASH__mgfzRCe5bWP__JHASH__"):h._("__JHASH__-fLc5wOF5_O__JHASH__")})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWV2RemoveMessageDialog.react",["MWV2GlobalRemoveMessageDialog.react","MWV2LocalRemoveMessageDialog.react","WebUXLoggingSurfaceContextProvider","emptyFunction","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(7),e=a.canRemoveMessageGlobally,f=a.learnMoreOnMessageRemove,g=a.message,h=a.onClose,j=a.removeLogger;a=a.threadType;h=h===void 0?c("emptyFunction"):h;j=j===void 0?c("emptyFunction"):j;var k;b[0]!==e||b[1]!==f||b[2]!==g||b[3]!==h||b[4]!==j||b[5]!==a?(k=i.jsx(d("WebUXLoggingSurfaceContextProvider").WebUXLoggingSurfaceContextProvider,{value:"message_unsend_sheet",children:e?i.jsx(c("MWV2GlobalRemoveMessageDialog.react"),{learnMoreOnMessageRemove:f,message:g,onClose:h,removeLogger:j,threadType:a}):i.jsx(c("MWV2LocalRemoveMessageDialog.react"),{message:g,onClose:h,removeLogger:j,threadType:a})}),b[0]=e,b[1]=f,b[2]=g,b[3]=h,b[4]=j,b[5]=a,b[6]=k):k=b[6];return k}g["default"]=a}),98);
__d("useMAWPRevokeMessage",["I64","Int64Hooks","LSMessagingThreadAttributionType","MAWBridgeSendAndReceive","MAWDbMsg","MAWGetProtocolMsgIdByMsgIdInUI","MAWMessageSendReporter","MAWMessageSendReporterV2","MWPActor.react","MessengerWebUXLogger","Promise","QPLUserFlow","Random","ReQL","ReQLSuspense","WAResultOrError","WebUserFlowLoggingDataContextProvider.react","gkx","promiseDone","qpl","react","react-compiler-runtime","react-forget-runtime","requireDeferred","sendToSentQPLLogger","useLSMessagingSource","useMWLSDefaultThreadSource","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;(k||d("react")).useContext;var l=c("requireDeferred")("MWLogSend").__setRef("useMAWPRevokeMessage");function a(a,e){var g=d("react-compiler-runtime").c(16),k=d("MWPActor.react").useActor(),o=(j||(j=c("useReStore")))(),p=c("useMWLSDefaultThreadSource")(),q=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("WebUserFlowLoggingDataContextProvider.react").WebUserFlowLoggingDataContext,n),r=q.loggingDataRef,s=c("MessengerWebUXLogger").useInteractionLogger();g[0]!==o.tables.threads||g[1]!==a?(q=function(){return d("ReQL").fromTableAscending(o.tables.threads).getKeyRange(a)},g[0]=o.tables.threads,g[1]=a,g[2]=q):q=g[2];var t;g[3]!==o||g[4]!==a?(t=[o,a],g[3]=o,g[4]=a,g[5]=t):t=g[5];var u=d("ReQLSuspense").useFirst(q,t,f.id+":64"),v=c("useLSMessagingSource")();g[6]!==o||g[7]!==p||g[8]!==s||g[9]!==r||g[10]!==v||g[11]!==k||g[12]!==u||g[13]!==e?(q=function(){return function(a,f){var g=[];f!=null?g.push.apply(g,f.messagesAndAttachments.map(m)):g.push(a);c("promiseDone")((h||(h=b("Promise"))).allSettled([g.map(function(a){var b=c("qpl")._(25308285,"2002"),f=Date.now()+(Math.round(d("Random").random()*1e4)+1e4),g=d("MAWDbMsg").toMsgId(a.messageId),h=(i||(i=d("I64"))).to_int32(a.displayedContentTypes),j={bool:{isValidMsgId:g!=null},"int":{authorityLevel:i.to_int32(a.authorityLevel),messageContentType:h},string:{isEphemeralMessage:a.ephemeralDurationInSec!=null||a.ephemeralExpirationTs!=null?"true":"false",type:"secureUnsendMessage"}};c("QPLUserFlow").start(b,{annotations:j,instanceKey:f});if(g==null){s==null?void 0:s(babelHelpers["extends"]({},r.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},r.current.extraData,{error:"missing_msg_id"})}));c("QPLUserFlow").endFailure(b,"missing_msg_id",{instanceKey:f});return}j=function(h){return d("MAWGetProtocolMsgIdByMsgIdInUI").getProtocolMsgIdByMsgIdUI(g).then(function(g){if(g==null){s==null?void 0:s(babelHelpers["extends"]({},r.current,{eventName:"message_remove_failure",eventType:"backend",extraData:babelHelpers["extends"]({},r.current.extraData,{error:"missing_protocolMsgId"})}));c("QPLUserFlow").endFailure(b,"missing_protocolMsgId",{instanceKey:f});return d("WAResultOrError").makeError({isRetriable:!0,type:"protocol-msg-id-null"})}var j=p(a.threadKey);l.onReady(function(b){var c=(i||(i=d("I64"))).to_string(a.threadKey);return b.log(o,{actor:k,attachmentFbids:[],attachmentType:26,backend:1,hasReply:!1,messagingThreadId:c,offlineThreadingId:g.externalId,sendType:0,source:j,threadKey:a.threadKey,threadType:e})});return d("MAWBridgeSendAndReceive").sendAndReceive("backend","sendRevokeMsg",{msgId:g,qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:h})})["catch"](function(a){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(h,"message_revoke_fail",a);throw a})};if(c("gkx")("8783"))return d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"useMAWPRevokeMessage",extraAnnotations:{"int":{originalMessageContentType:h}},lsSource:v,messageTypeParamsArgs:{isUnsend:!0},thread:u},j).then(function(){s==null?void 0:s(babelHelpers["extends"]({},r.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(b,{instanceKey:f})});else{h=d("sendToSentQPLLogger").markSendToSentStartWithAnnotation(u,{isUnsend:!0},c("LSMessagingThreadAttributionType").UNKNOWN,{"int":{originalMessageContentType:h}});return d("MAWMessageSendReporter").MAWMessageSendReporter(null,j(h),{qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:h},o).then(function(){s==null?void 0:s(babelHelpers["extends"]({},r.current,{eventName:"message_remove_success",eventType:"backend"})),c("QPLUserFlow").endSuccess(b,{instanceKey:f})})}})]))}},t=[o,p,s,r,v,k,u,e],g[6]=o,g[7]=p,g[8]=s,g[9]=r,g[10]=v,g[11]=k,g[12]=u,g[13]=e,g[14]=q,g[15]=t):(q=g[14],t=g[15]);return d("Int64Hooks").useMemoInt64(q,t)}function m(a){return a.message}function n(a){return[a.loggingDataRef]}g["default"]=a}),98);