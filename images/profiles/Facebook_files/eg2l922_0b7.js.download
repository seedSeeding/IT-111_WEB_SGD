;/*FB_PKG_DELIM*/

__d("MWRetryMessageSend.react",["fbt","BaseMiddot.react","FBLogger","I64","LSIntEnum","LSThreadAttributionTypeUtil","MAWMessageSendReporterV2","MAWMiActOnActThreadReady","MWSharedMsgLogUtils","MWXLink.react","MWXSpinner.react","MWXText.react","MessengerWebUXLogger","ReQL","WAStanzaUtils","asyncToGeneratorRuntime","gkx","promiseDone","react","react-compiler-runtime","sendToSentQPLLogger","setTimeout","useAsyncReStore","useLSMessagingSource","useMAWSendMessageV2","useMWLSDefaultThreadSource"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=i||(i=d("react")),m=i.useState,n={loadingSpinner:{display:"x3nfvp2",paddingTop:"x1iorvi4",paddingEnd:"x4uap5",paddingBottom:"x18d9i69",paddingStart:"xurb0ha",$$css:!0}};function a(a){var e=d("react-compiler-runtime").c(13),f=a.message,g=c("useAsyncReStore")(),i=c("useMWLSDefaultThreadSource")(),o=c("useMAWSendMessageV2")(),p=c("MessengerWebUXLogger").useInteractionLogger();e[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={eventName:"secure_message_retry_impression"},e[0]=a):a=e[0];a=c("MessengerWebUXLogger").useImpressionLoggerRef(a);var q=c("useLSMessagingSource")(),r=m(!1),s=r[0],t=r[1];r=m(!1);var u=r[0],v=r[1],w=s||u;e[1]!==g||e[2]!==i||e[3]!==w||e[4]!==p||e[5]!==q||e[6]!==f||e[7]!==o?(r=function(){if(w)return;t(!0);v(!0);c("setTimeout")(function(){t(!1)},1e3);p==null?void 0:p({eventName:"secure_message_retry_lick"});c("promiseDone")(g,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(f.threadKey))),g=d("WAStanzaUtils").toStanzaId(f.offlineThreadingId),h=function(){var h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){d("sendToSentQPLLogger").markSendToSentPoint(b,"retry_secure_message_start");if(e==null){c("gkx")("8783")||d("sendToSentQPLLogger").markSendToSentFail(b,"message_retry_fail");throw c("FBLogger")("messenger_web_messaging").mustfixThrow("Failed while fetching thread from DB in MWRetryMessageSend.react")}var h=(yield d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,e.threadKey,"getChatJid"));return o(a,e.threadKey,e.threadType,h.chatJid,(h=f.text)!=null?h:"",i(e.threadKey),void 0,f.offlineThreadingId,(j||(j=d("I64"))).to_int32(f.timestampMs),f.hotEmojiSize,!1,void 0,void 0,void 0,void 0,void 0,b,g).then(function(a){v(!1);return a},function(a){v(!1);return a})});return function(a){return h.apply(this,arguments)}}();if(c("gkx")("8783"))return d("MAWMessageSendReporterV2").MAWMessageSendReporterV2({composerEntrypoint:"retry-button",externalId:g,lsSource:q,messageTypeParamsArgs:{hotEmojiSize:f.hotEmojiSize,messageText:f.text},thread:e},h,a);else{var l=d("sendToSentQPLLogger").markSendToSentStart();if(e){var m=d("LSThreadAttributionTypeUtil").getSource(e.threadKey,q),n=d("MWSharedMsgLogUtils").getMessageTypeParams({hotEmojiSize:f.hotEmojiSize,messageText:f.text,threadType:e.threadType});d("sendToSentQPLLogger").addSendToSentAnnotations(l,yield d("MWSharedMsgLogUtils").getSendToSentAnnotations(e,n,(k||(k=d("LSIntEnum"))).unwrapIntEnum(m),"retry-button"))}return h(l)}});return function(b){return a.apply(this,arguments)}}())},e[1]=g,e[2]=i,e[3]=w,e[4]=p,e[5]=q,e[6]=f,e[7]=o,e[8]=r):r=e[8];s=r;e[9]!==w||e[10]!==a||e[11]!==s?(u=l.jsx(l.Fragment,{children:w?l.jsx(c("MWXSpinner.react"),{color:"disabled",size:12,xstyle:n.loadingSpinner}):l.jsxs(l.Fragment,{children:[l.jsx(c("BaseMiddot.react"),{}),l.jsx(c("MWXText.react"),{color:"negative",type:"bodyLink4",children:l.jsx(c("MWXLink.react"),{onClick:s,ref:a,children:h._("__JHASH__9CDNHt9PfWl__JHASH__")})})]})}),e[9]=w,e[10]=a,e[11]=s,e[12]=u):u=e[12];return u}g["default"]=a}),226);
__d("useMawDbInUI",["LSSuspense","MAWIndexedDbUI","MAWStateContext.react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||(h=c("LSSuspense"))).makeCollection();function a(){var a=d("react-compiler-runtime").c(1),b=d("MAWStateContext.react").useMAWSelector(k);if(b){a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=(h||(h=c("LSSuspense"))).getFromCollection(i,d("MAWIndexedDbUI").MawDbInUISingleton,j),a[0]=b):b=a[0];return b}}function j(){return d("MAWIndexedDbUI").MawDbInUISingleton}function k(a){return a.isMAWDBinUILoaded}g["default"]=a}),98);